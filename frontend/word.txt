FE ( Tá»° TÃŒM HIá»‚U pháº§n nÃ y)
Ã tÆ°á»Ÿng cho FE gá»­i deviceId khi login vá»›i React + TailwindCSS nhÆ° sau:
1.	Táº¡o deviceId duy nháº¥t: Khi ngÆ°á»i dÃ¹ng má»Ÿ láº§n Ä‘áº§u, FE táº¡o má»™t UUID vÃ  lÆ°u vÃ o localStorage (hoáº·c cookie). Láº§n sau má»Ÿ láº¡i, láº¥y deviceId tá»« localStorage.
2.	Gá»­i cÃ¹ng login request: Khi user submit form login, kÃ¨m deviceId trong body JSON tá»›i backend cÃ¹ng email vÃ  password.
3.	Backend xÃ¡c Ä‘á»‹nh thiáº¿t bá»‹: Náº¿u thiáº¿t bá»‹ chÆ°a tin cáº­y, backend gá»­i OTP; náº¿u Ä‘Ã£ tin cáº­y, cáº¥p token luÃ´n.
4.	Xá»­ lÃ½ MFA: Náº¿u user báº­t MFA, FE hiá»ƒn thá»‹ input nháº­p mÃ£ Google Authenticator; backend sáº½ dÃ¹ng deviceId Ä‘á»ƒ Ä‘Ã¡nh dáº¥u thiáº¿t bá»‹ sau khi MFA thÃ nh cÃ´ng.
5.	LÆ°u deviceId lÃ¢u dÃ i: KhÃ´ng xÃ³a khi logout, giÃºp nháº­n diá»‡n thiáº¿t bá»‹ quen thuá»™c láº§n sau; cÃ³ thá»ƒ reset náº¿u user muá»‘n.
NÃ³i ngáº¯n gá»n: FE táº¡o + lÆ°u deviceId â†’ gá»­i kÃ¨m login â†’ backend quyáº¿t Ä‘á»‹nh OTP hay token â†’ MFA náº¿u cáº§n â†’ Ä‘Ã¡nh dáº¥u thiáº¿t bá»‹ trusted.














ğŸ§© 1ï¸âƒ£ ÄÄƒng kÃ½ tÃ i khoáº£n (Register)
Endpoint:
POST http://localhost:8080/auth/register
Body
{
  "email": "tauhaitac3k5@gmail.com",
  "password": "123456",
  "fullName": "Luffy Monkey",
  "phone": "0987654321"
}
Response:
{
  "status": 200,
  "message": "User created successfully",
  "data": "Táº¡o tÃ i khoáº£n thÃ nh cÃ´ng"
}
________________________________________
ğŸ§© 2ï¸âƒ£ ÄÄƒng nháº­p â€” FE cÃ³ 2 lá»±a chá»n
ğŸ”¸ Lá»±a chá»n 1: ÄÄƒng nháº­p qua Google (OAuth2)
Frontend flow:
â€¢	FE gá»i link:
â€¢	http://localhost:8080/oauth2/authorization/google
â€¢	TrÃ¬nh duyá»‡t sáº½ má»Ÿ popup Ä‘Äƒng nháº­p Google.
â€¢	Sau khi xÃ¡c thá»±c thÃ nh cÃ´ng, server sáº½:
o	Láº¥y email + name tá»« Google.
o	Náº¿u chÆ°a tá»“n táº¡i user â†’ táº¡o má»›i.
o	Sinh accessToken + refreshToken.
o	Tá»± Ä‘á»™ng báº­t MFA (náº¿u chÆ°a cÃ³) â†’ generate secret vÃ  QR, gá»­i kÃ¨m URL cho FE.
o	Redirect vá» FE táº¡i URL sau:
â€¢	http://localhost:3000/oauth2/success
KÃ¨m query params:
?accessToken=<JWT_ACCESS_TOKEN>
&refreshToken=<JWT_REFRESH_TOKEN>
&mfaEnabled=true
&qrBase64=<BASE64_IMAGE_IF_NEW>
FE xá»­ lÃ½:
â€¢	Náº¿u cÃ³ qrBase64 â†’ hiá»ƒn thá»‹ QR code cho ngÆ°á»i dÃ¹ng quÃ©t vÃ o Google Authenticator.
â€¢	Náº¿u khÃ´ng cÃ³ (user Ä‘Ã£ báº­t MFA trÆ°á»›c Ä‘Ã³) â†’ bá» qua.
________________________________________
ğŸ”¸ Lá»±a chá»n 2: ÄÄƒng nháº­p báº±ng Email + Password (vá»›i OTP mail)
Endpoint:
POST http://localhost:8080/auth/login
Body
{
  "email": "tauhaitac3k5@gmail.com",
  "password": "123456",
  "deviceId": "DEVICE-ABC123"
}
Response:
1.	Náº¿u thiáº¿t bá»‹ má»›i â†’ yÃªu cáº§u xÃ¡c thá»±c OTP:
{
  "status": 200,
  "message": "Thiáº¿t bá»‹ má»›i phÃ¡t hiá»‡n. MÃ£ OTP Ä‘Ã£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n email cá»§a báº¡n.",
  "data": ""
}
2.	Náº¿u thiáº¿t bá»‹ Ä‘Ã£ tin cáº­y â†’ tráº£ token:
{
  "status": 200,
  "message": "ÄÄƒng nháº­p thÃ nh cÃ´ng (thiáº¿t bá»‹ quen thuá»™c)",
  "data": {
    "accessToken": "<JWT_ACCESS_TOKEN>",
    "refreshToken": "<JWT_REFRESH_TOKEN>",
    "mfaRequired": false
  }
}
________________________________________
ğŸ§© 3ï¸âƒ£ XÃ¡c thá»±c OTP (náº¿u login qua mail)
Endpoint:
POST http://localhost:8080/auth/verify-otp
Body
{
  "email": "tauhaitac3k5@gmail.com",
  "otp": "123456",
  "deviceId": "DEVICE-ABC123"
}
Response:
1ï¸âƒ£ Náº¿u user chÆ°a báº­t MFA
â†’ Tráº£ token luÃ´n, thiáº¿t bá»‹ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u tin cáº­y.
{
  "status": 200,
  "message": "OTP xÃ¡c thá»±c thÃ nh cÃ´ng. Thiáº¿t bá»‹ Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  tin cáº­y.",
  "data": {
    "accessToken": "<JWT_ACCESS_TOKEN>",
    "refreshToken": "<JWT_REFRESH_TOKEN>",
    "mfaRequired": false
  }
}
2ï¸âƒ£ Náº¿u user Ä‘Ã£ báº­t MFA
â†’ FE hiá»ƒn thá»‹ form nháº­p mÃ£ Google Authenticator (code 6 sá»‘).
{
  "status": 200,
  "message": "OTP há»£p lá»‡. Vui lÃ²ng nháº­p mÃ£ Google Authenticator (MFA)",
  "data": {
    "accessToken": null,
    "refreshToken": null,
    "mfaRequired": true
  }
}
________________________________________
ğŸ§© 4ï¸âƒ£ XÃ¡c thá»±c mÃ£ Google Authenticator (MFA)
Endpoint:
POST http://localhost:8080/auth/mfa/verify
Body
{
  "email": "tauhaitac3k5@gmail.com",
  "code": 123456
}
Response:
{
  "status": 200,
  "message": "ÄÄƒng nháº­p thÃ nh cÃ´ng (MFA)",
  "data": {
    "accessToken": "<JWT_ACCESS_TOKEN>",
    "refreshToken": "<JWT_REFRESH_TOKEN>",
    "mfaRequired": false
  }
}
________________________________________
ğŸ§© 5ï¸âƒ£ (Tá»± Ä‘á»™ng) Báº­t MFA khi Ä‘Äƒng nháº­p Google láº§n Ä‘áº§u
hoáº·c ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ báº­t thá»§ cÃ´ng náº¿u muá»‘n.
Endpoint:
POST http://localhost:8080/auth/mfa/enable?email=<email>
Response:
{
  "status": 200,
  "message": "MFA enabled. Scan QR code in Google Authenticator",
  "data": {
    "secret": "K26SNOR55B3IEFXJN4WEYTNIP7A6V3SL",
    "qrBase64": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUg..."
  }
}
FE xá»­ lÃ½:
â€¢	Copy pháº§n qrBase64 â†’ render <img src={qrBase64} />
â€¢	NgÆ°á»i dÃ¹ng quÃ©t QR trÃªn á»©ng dá»¥ng Google Authenticator Ä‘á»ƒ nháº­n mÃ£ 6 sá»‘.
________________________________________
ğŸ§© 6ï¸âƒ£ LÃ m má»›i Access Token báº±ng Refresh Token
Endpoint:
POST http://localhost:8080/auth/refresh
Header:
Authorization: Bearer <refresh_token>
Response:
{
  "status": 200,
  "message": "Access token refreshed successfully",
  "data": "<new_access_token>"
}
________________________________________
ğŸ§© 7ï¸âƒ£ Logout
Endpoint:
POST http://localhost:8080/auth/logout
Header:
Authorization: Bearer tauhaitac3k5@gmail.com
Response:
{
  "status": 200,
  "message": "Logged out successfully",
  "data": "ÄÄƒng xuáº¥t thÃ nh cÃ´ng"
}
________________________________________
âš™ï¸ TÃ“M Táº®T DÃ€NH CHO FRONTEND
BÆ°á»›c	API	Má»¥c Ä‘Ã­ch	FE cáº§n lÃ m gÃ¬
1	/auth/register	ÄÄƒng kÃ½ tÃ i khoáº£n má»›i	Gá»­i form Ä‘Äƒng kÃ½
2	/auth/login	ÄÄƒng nháº­p thÆ°á»ng (email + password + deviceId)	Gá»­i credentials; náº¿u tráº£ â€œgá»­i OTPâ€ thÃ¬ chuyá»ƒn sang bÆ°á»›c 3
3	/auth/verify-otp	XÃ¡c thá»±c OTP tá»« mail	Gá»­i OTP + deviceId; náº¿u mfaRequired=true thÃ¬ sang bÆ°á»›c 4
4	/auth/mfa/verify	XÃ¡c thá»±c code tá»« Google Authenticator	Gá»­i code 6 sá»‘
5	/auth/mfa/enable	(Tuá»³ chá»n) Báº­t MFA cho user	Hiá»ƒn thá»‹ QR code Ä‘á»ƒ user quÃ©t
6	/oauth2/authorization/google	ÄÄƒng nháº­p qua Google (OAuth2)	FE redirect user qua URL nÃ y, backend sáº½ tráº£ vá» accessToken, refreshToken, vÃ  qrBase64 náº¿u cáº§n
7	/auth/refresh	LÃ m má»›i access token	Gá»­i refresh token
8	/auth/logout	ÄÄƒng xuáº¥t	Gá»­i email hoáº·c token hiá»‡n táº¡i

